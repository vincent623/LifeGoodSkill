# Conversation Title: windows 远程桌面网线直连，无法连接
无法连接到远程 PC。请确保该 PC 已打开并连接到网络...
Original URL: https://gemini.google.com/app/d1a973c3258bd249
Platform: Gemini
Created At: 2026-01-23 11:11:33
Total Messages: 8

---

User：[2026-01-23 11:11:33]
windows 远程桌面网线直连，无法连接
无法连接到远程 PC。请确保该 PC 已打开并连接到网络，且已启用远程访问。
错误代码：Ox204

AI：[2026-01-23 11:12:00]
这是一个非常典型的网络配置问题，特别是在**网线直连（Direct Ethernet Connection）**这种无 DHCP 环境下。

错误代码 0x204（在 Mac 的 Microsoft Remote Desktop 客户端中常见）明确表示网络不可达。这意味着客户端根本找不到宿主机的 IP，或者请求被防火墙拦截了。

鉴于你的技术背景（全栈/产品架构），我们直接切入最可能的根因：IP 子网不匹配 和 Windows 网络配置文件类型（Public vs Private）。

请按以下步骤排查：

1. 强制静态 IP 配置（最稳妥方案）

在直连模式下，如果依赖 APIPA（169.254.x.x 自动私有地址），握手极慢且不稳定。请手动锁定双端 IP。

Windows 端（宿主机）：

打开网络适配器设置，找到对应的以太网网口。

设置 IPv4 为手动：

IP: 192.168.50.1 (举例)

掩码: 255.255.255.0

网关: 留空（直连不需要网关）

Mac 端（客户端）：

设置 -> 网络 -> 以太网。

配置 IPv4 为手动：

IP: 192.168.50.2

掩码: 255.255.255.0

路由器/网关: 留空

2. 修改 Windows 网络类别（关键隐患）

Windows 默认会将未识别的直连网络归类为 "公用网络" (Public Network)。 后果： Windows 防火墙会默认拦截 Public 网络下的 RDP (3389 端口) 请求。

解决方法（PowerShell 管理员模式）：

查看当前网络连接：

PowerShell
Get-NetConnectionProfile
(找到你的直连以太网，查看其 NetworkCategory 是否为 Public)

强制将其改为 Private（专用网络）：

PowerShell
Set-NetConnectionProfile -InterfaceIndex <你的接口索引号> -NetworkCategory Private
(或者直接用名称匹配，如果名字是 "Unidentified network")

3. 测试连通性

在 Mac 的终端（Terminal）中 Ping 宿主机：

Bash
ping 192.168.50.1
如果 Ping 不通： 检查网线物理连接或确认网卡是否被禁用。

如果 Ping 通但 RDP 仍报错： 检查 Windows 上的 3389 端口是否被监听。

4. RDP 客户端连接技巧

地址栏输入： 必须使用 IP 地址连接（如 192.168.50.1），不要使用计算机名（Hostname）。

原因：直连环境没有 DNS 服务器，mDNS 广播在跨系统间解析通常不稳定。

用户验证： 确保你使用的是 MicrosoftAccount\你的邮箱 或者 本地主机名\用户名 的格式。

Next Step: 如果你 Ping 是通的，但依然 0x204，你可以尝试在 Windows 终端运行 netstat -an | findstr 3389 确认端口监听状态，或者告诉我 Ping 的结果，我帮你进一步判断防火墙规则。

User：[2026-01-23 11:13:44]
❯ ping 169.254.21.221

PING 169.254.21.221 (169.254.21.221): 56 data bytes

Request timeout for icmp_seq 0

Request timeout for icmp_seq 1

Request timeout for icmp_seq 2

Request timeout for icmp_seq 3

ping: sendto: No route to host

Request timeout for icmp_seq 4

ping: sendto: Host is down

Request timeout for icmp_seq 5

ping: sendto: Host is down

Request timeout for icmp_seq 6

ping: sendto: Host is down

Request timeout for icmp_seq 7

ping: sendto: Host is down

Request timeout for icmp_seq 8

ping: sendto: Host is down

Request timeout for icmp_seq 9

ping: sendto: Host is down

Request timeout for icmp_seq 10

ping: sendto: Host is down

Request timeout for icmp_seq 11

ping: sendto: Host is down

Request timeout for icmp_seq 12

^C

--- 169.254.21.221 ping statistics ---

14 packets transmitted, 0 packets received, 100.0% packet loss

AI：[2026-01-23 11:14:19]
这里的 Ping 失败日志非常明确：No route to host 和 Host is down。

这证实了 APIPA（自动分配的 169.254.x.x 地址）在你的环境中不可用。

为什么会失败？

路由混乱 (No route to host)： Mac 同时连接了 Wi-Fi 和网线。当你 Ping 169.254.x.x 时，Mac 的路由表可能默认试图走 Wi-Fi 网关，而不是走网线接口。因为 Wi-Fi 路由器不认识这个直连 IP，所以直接报错“没有路由”。

握手未完成： 在直连且无 DHCP 的情况下，两端设备协商 IP 需要时间。如果两端没有处于同一个“链路本地”广播域，或者 Windows 那边因为识别不到网关而间歇性重置网卡，连接就会断。

解决方案：必须配置静态 IP

既然你是全栈背景，不要依赖 OS 的自动协商（APIPA），那是给小白用的，而且极其不稳定。请手动构建一个纯净的局域网子网。

请严格按照以下步骤操作，彻底抛弃 169.254 地址：

第一步：配置 Windows (被控端)

打开 控制面板 -> 网络和共享中心 -> 更改适配器设置。

右键点击连接网线的 以太网适配器 -> 属性。

双击 IPv4。

选择“使用下面的 IP 地址”：

IP 地址: 10.10.10.1 (使用 A 类私有地址更不易与家中 192.168 的 Wi-Fi 冲突)

子网掩码: 255.255.255.0

默认网关: 留空 (非常重要，防止 Windows 试图通过这根线通过互联网)

第二步：配置 Mac (主控端)

打开 系统设置 -> 网络 -> 以太网。

点击 IPv4 旁边的“详细信息”或下拉菜单。

配置为 手动 (Manually)：

IP 地址: 10.10.10.2

子网掩码: 255.255.255.0

路由器/网关: 留空

第三步：验证与连接

拔掉两端网线，重新插上（强制触发物理层重置）。

在 Mac 终端 Ping 新地址：

Bash
ping 10.10.10.1
如果能 Ping 通，立刻使用 Microsoft Remote Desktop 连接 10.10.10.1。

如果 Ping 通了但 RDP 还是 0x204？

那就是刚才提到的 Windows 网络类型问题。因为手动设置 IP 后，Windows 99% 的概率会把这个网络判定为“未识别网络（公用）”，从而防火墙拦截 RDP。

极速修正（在 Windows PowerShell 管理员模式下）：

PowerShell
# 将所有以太网接口强制设为专用网络（信任模式）
Get-NetConnectionProfile | Where-Object { $_.InterfaceAlias -like "*Ethernet*" } | Set-NetConnectionProfile -NetworkCategory Private
Next Step: 请按照上述配置设置 10.10.10.x 网段。如果配置后 Ping 依然是 Request timeout，请告诉我 Windows 端的防火墙是否使用了第三方软件（如火绒、360）？

User：[2026-01-23 11:18:43]
第一步：配置 Windows (被控端),提示无法保存IP设置，

AI：[2026-01-23 11:19:11]
Windows GUI 在检测到潜在的路由冲突或权限不足时，经常会弹出这种模棱两可的“无法保存”错误。

既然你是走技术路线的（Full-Stack/Product Architect），我们直接绕过容易出 Bug 的图形界面，使用 PowerShell 强制写入配置。这能让你看到真正的底层报错，或者直接强制生效。

请在 Windows 上以管理员身份打开 PowerShell，按以下步骤操作：

1. 找到网卡的 Interface Index (索引号)

我们需要确定你要配置的是哪块网卡，避免配错到 Wi-Fi 上。

PowerShell
Get-NetAdapter
在输出列表中找到连接网线的那个适配器（通常 Status 是 Up，名字可能是 Ethernet 或 以太网）。

记下它的 ifIndex (例如：12)。

2. 清除旧配置（防止残留冲突）

假设你的 ifIndex 是 12（请替换为你实际的数字）：

PowerShell
# 删除该接口上现有的所有 IP 配置
Remove-NetIPAddress -InterfaceIndex 12 -Confirm:$false
如果报错说找不到对象，说明本来就是空的，直接忽略即可。

3. 强制写入静态 IP

我们继续尝试 10.10.10.1。但如果你的 Wi-Fi 正好也是 10 段的（很多公司内网是 10 段），这会导致路由冲突，Windows 就会拒绝保存。

为了保险，我们这次换一个极冷门的网段：172.25.25.1。

在 PowerShell 中执行：

PowerShell
# 语法：New-NetIPAddress -InterfaceIndex <索引> -IPAddress <IP> -PrefixLength <掩码位>
New-NetIPAddress -InterfaceIndex 12 -IPAddress 172.25.25.1 -PrefixLength 24
(注意：-PrefixLength 24 等同于子网掩码 255.255.255.0)

4. 观察报错

如果成功： 你会看到一个返回的表格对象，显示 IP 已配置。

如果失败： PowerShell 会吐出具体的红色错误信息（比如 InstanceAlreadyExists 或 InvalidParameter）。

如果是 InstanceAlreadyExists：说明旧 IP 没删干净，再次运行上面的 Remove 命令。

如果是路由冲突相关：说明你的 Wi-Fi 可能占用了这个网段。

Mac 端对应修改

如果 Windows 端配置成功为 172.25.25.1，请立刻去 Mac 端把以太网手动 IP 改为：

IP: 172.25.25.2

掩码: 255.255.255.0

路由: 空

然后立刻在 Mac 终端 Ping：

Bash
ping 172.25.25.1
Next Step: 如果 PowerShell 报错，请直接把红字错误信息贴给我，我能通过错误码判断是驱动锁死还是策略拦截。如果 Ping 通了，我们下一步解决防火墙。

User：[2026-01-23 11:25:34]
通了，~/desktop took 13s

❯ ping 172.25.25.1

PING 172.25.25.1 (172.25.25.1): 56 data bytes

64 bytes from 172.25.25.1: icmp_seq=0 ttl=128 time=1.526 ms

64 bytes from 172.25.25.1: icmp_seq=1 ttl=128 time=1.042 ms

64 bytes from 172.25.25.1: icmp_seq=2 ttl=128 time=0.976 ms

64 bytes from 172.25.25.1: icmp_seq=3 ttl=128 time=1.033 ms

64 bytes from 172.25.25.1: icmp_seq=4 ttl=128 time=0.986 ms

64 bytes from 172.25.25.1: icmp_seq=5 ttl=128 time=0.824 ms

64 bytes from 172.25.25.1: icmp_seq=6 ttl=128 time=1.024 ms

64 bytes from 172.25.25.1: icmp_seq=7 ttl=128 time=0.995 ms

64 bytes from 172.25.25.1: icmp_seq=8 ttl=128 time=1.051 ms

64 bytes from 172.25.25.1: icmp_seq=9 ttl=128 time=0.831 ms

64 bytes from 172.25.25.1: icmp_seq=10 ttl=128 time=1.019 ms

64 bytes from 172.25.25.1: icmp_seq=11 ttl=128 time=1.012 ms

64 bytes from 172.25.25.1: icmp_seq=12 ttl=128 time=0.916 ms

64 bytes from 172.25.25.1: icmp_seq=13 ttl=128 time=1.207 ms

64 bytes from 172.25.25.1: icmp_seq=14 ttl=128 time=1.000 ms

64 bytes from 172.25.25.1: icmp_seq=15 ttl=128 time=0.904 ms

64 bytes from 172.25.25.1: icmp_seq=16 ttl=128 time=1.013 ms

64 bytes from 172.25.25.1: icmp_seq=17 ttl=128 time=1.090 ms

64 bytes from 172.25.25.1: icmp_seq=18 ttl=128 time=1.007 ms

^C

--- 172.25.25.1 ping statistics ---

19 packets transmitted, 19 packets received, 0.0% packet loss

round-trip min/avg/max/stddev = 0.824/1.024/1.526/0.145 ms

AI：[2026-01-23 11:25:56]
太棒了！延时 1ms，丢包率 0%，这是完美的物理层和网络层连接。

现在只剩下最后一公里：应用层（RDP）。

由于这是你刚手动创建的新网络，Windows 防火墙极大概率会把它当作“公用网络”处理，从而直接拦截 3389 端口。如果不解开这个拦截，你即使 Ping 通了，RDP 依然会报 0x204。

请在 Windows 上执行这最后一步“解锁”操作，然后就可以连接了：

1. 强制将该网络设为“专用” (信任模式)

在 Windows 的 PowerShell (管理员) 中运行：

PowerShell
# 1. 查找刚才那个 172.25.25.1 的网络接口索引 (InterfaceIndex)
Get-NetConnectionProfile

# 2. 如果看到它的 NetworkCategory 是 "Public"，执行下面这句强制改为 Private
# (假设索引号还是 12，请替换为你实际看到的)
Set-NetConnectionProfile -InterfaceIndex 12 -NetworkCategory Private

2. 发起 RDP 连接

回到你的 Mac Microsoft Remote Desktop 客户端：

PC Name (Host): 172.25.25.1

User Account: 建议新建一个配置，手动输入。

如果你是用微软账号登录 Windows：用户名为 MicrosoftAccount\你的邮箱@outlook.com

如果你是本地账号：用户名为 机器名\用户名 (例如 MyWinPC\Vincent)

3. (可选) 最后的保险

如果在 Mac 上连接还转圈，可以在 Mac 终端验证端口是否开放：

Bash
nc -z -v 172.25.25.1 3389
Succeeded! -> 配置完成，如果连不上是账号密码问题。

Refused / Timeout -> 防火墙还是没放行，检查 Windows 设置里的“允许远程桌面”开关是否打开。

Next Step: 现在你应该能看到 Windows 的登录界面了。如果遇到黑屏或者画质很差，记得在 RDP 客户端设置里把 "Use hardware acceleration" (硬件加速) 关掉，或者把分辨率调低一点，直连虽然带宽大，但有时候显卡传输协议会打架。

